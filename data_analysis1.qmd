---
title: "Project 2: Preliminary Analysis"
author: "Lucy Watts, Natalie Lau, Catherine Weeks, and Nandir Altansukh"
format: html
---

## Preliminary Data Analysis

```{r}
#| warning: false
#| message: false
#| echo: false

# Set Up
library(tidyverse)
library(lubridate)

spotify_songs_raw <- read.csv("spotify_songs.csv")

spotify_songs_cleaned <- spotify_songs_raw |>
  mutate(track_album_release_date = ymd(track_album_release_date)) |>
  select(track_id, track_name, track_artist, track_popularity, track_album_release_date, danceability, energy, key,
         loudness, mode, valence, tempo, duration_ms) |>
  filter(year(track_album_release_date) == 2019) |>
  filter(str_detect(track_name,
                    "Remix|Remaster|Remastered|REMIX|remix") == FALSE) |>
  unique() |>
  mutate(song_percentile = percent_rank(track_popularity)*100) |>
  filter(song_percentile >= 90) |>
  arrange(desc(song_percentile))

```

Visualizing Key and Loudness

```{r}
ggplot(spotify_songs_cleaned, aes(x = key, y = track_popularity)) +
  geom_point(position = position_jitter(seed=100)) +
  theme_minimal() + 
  labs(title = "Key and Track Popularity", 
       x = "Key",
       y = "Track Popularity")
```

```{r}
ggplot(spotify_songs_cleaned, aes(x = loudness, y = track_popularity)) +
  #geom_point(position = position_jitter(seed=100)) +
  geom_point(position = position_jitter(seed=100)) +
  theme_minimal() + 
  labs(title = "Loudness and Track Popularity", 
       x = "Loudness",
       y = "Track Popularity")
```

Different visualizations

```{r}
ggplot(spotify_songs_cleaned, aes(x = key)) +
  geom_bar() +
  theme_minimal() + 
  labs(title = "Analysis of keys in top songs", 
       x = "Key")
```

Probably no relationship between popular songs and their key?

```{r}
ggplot(spotify_songs_cleaned, aes(x = loudness)) +
  geom_histogram(bins = 20) +
  theme_minimal() + 
  labs(title = "Analysis of keys in top songs", 
       x = "Loudness")
```

It looks like louder songs are popular
```

### Mode vs Popularity

```{r}
# Major is 1, minor is 0

mode_popularity <- spotify_songs_cleaned |>
  group_by(mode) |>
  summarize(num_songs = n(),
            avg_popularity = mean(track_popularity))

mode_popularity

spotify_songs_cleaned |>
  mutate(mode = factor(mode, labels = c("minor", "major"))) |>
  ggplot(aes(x = track_popularity, group = mode, color = mode)) +
  geom_density()
```

### Valence vs Popularity

```{r}
spotify_songs_cleaned |>
  ggplot(aes(x = valence, y = track_popularity)) +
  geom_point()
```

