---
title: "Project 2: Preliminary Analysis"
author: "Lucy Watts, Natalie Lau, Catherine Weeks, and Nandir Altansukh"
format: html
---

## Preliminary Data Analysis

```{r}
#| warning: false
#| message: false
#| echo: false

# Set Up
library(tidyverse)
library(lubridate)

spotify_songs_cleaned <- read_csv("spotify_cleaned.csv")
```

#### Danceability

@fig-danceability looks at the relationship between danceability and track popularity. It seems as though a lot of the most popular songs are clustered around the 0.75 value of danceability.

```{r}
#| warning: false
#| message: false
#| echo: false
#| include: false

spotify_songs_cleaned |>
select(track_popularity, danceability, energy)
```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-danceability
#| fig-cap: "Track danceability and popularity."


spotify_songs_cleaned |>
ggplot(aes(x = danceability, y = track_popularity)) +
geom_point(alpha = 0.6) +
labs(
title = "Danceability vs Track Popularity (Top 10% of 2019 Songs)",
x = "Danceability",
y = "Track Popularity"
) + theme_minimal()

```

#### Energy

@fig-energy looks at the energy of a track and its popularity. It looks similar to our danceability plot, with a lot of popular songs grouping around the 0.75 Energy mark.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-energy
#| fig-cap: "Track energy and popularity."
spotify_songs_cleaned |>
ggplot(aes(x = energy, y = track_popularity)) +
geom_point(alpha = 0.6) +
labs(
title = "Energy vs Track Popularity (Top 10% of 2019 Songs)",
x = "Energy",
y = "Track Popularity"
) + theme_minimal()
```

#### Key

@fig-key shows the distribution of key in our top songs. While some keys are more popular than others, it doesn't appear as though there's any type of relationship between key and popularity of a song.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-key
#| fig-cap: "Track key and popularity."
ggplot(spotify_songs_cleaned, aes(x = key)) +
  geom_bar() +
  theme_minimal() + 
  labs(title = "Key vs Track Popularity (Top 10% of 2019 Songs)", 
       x = "Key")
```

#### Loudness

@fig-loud shows the correlation between loudness and track popularity. It appears as though songs with a loudness closer to 0 but around -5 make up the most popular 10% of songs in 2019.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-loud
#| fig-cap: "Track loudness and popularity."
ggplot(spotify_songs_cleaned, aes(x = loudness, y = track_popularity)) +
  geom_point() +
  theme_minimal() + 
  labs(title = "Loudness vs Track Popularity (Top 10% of 2019 Songs)",
       x = "Loudness",
       y = "Track Popularity")
```

#### Tempo

@fig-tempo shows the relationship between tempo and track popularity. There seems to be a potential very weak relationship between these two variables, based on the spread of our scatterplot. Overall, songs that have tempos around 100 bpm seem to be more popular. There are a few songs around the 175 bmp that are more popular.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-tempo
#| fig-cap: "Track tempo and popularity."
ggplot(data = spotify_songs_cleaned,
       aes(x = tempo, y = track_popularity)) +
  geom_point() +
  labs(title = "Tempo vs Track Popularity (Top 10% of 2019 Songs)",
       x = "Tempo",
       y = "Popularity") +
  theme_minimal()
```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: tbl-tempo
library(knitr)
spofity_songs_summary <- spotify_songs_cleaned |>
  group_by(tempo) |>
  summarise(
    avg_pop = mean(track_popularity, na.rm = TRUE),
    max_pop = max(track_popularity, na.rm = TRUE),
    min_pop = min(track_popularity, na.rm = TRUE),
    number_of_songs = n()
  )
kable(head(spofity_songs_summary))
```

#### Duration

@fig-duration shows that most songs are around 3-4 minutes. It seems like songs closer to 3 minutes are more popular but there isn't a huge correlation between duration of a song and it's popularity.

```{r}
#| warning: false
#| message: false
#| echo: false
spotify_songs_cleaned <- spotify_songs_cleaned |>
  mutate(duration_min = duration_ms / (1000 * 60))
# converted milliseconds to minutes 
```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-duration
#| fig-cap: "Track duration and popularity."
ggplot(data = spotify_songs_cleaned, aes(x = track_popularity, y = duration_min)) +
  geom_point() +
  labs(title = "Duration vs Track Popularity (Top 10% of 2019 Songs)",
       x = "Track Popularity",
       y = "Minutes") +
  theme_minimal()
```

#### Mode

@fig-mode shows the relationship of song mode (if it's major or minor) and the popularity of a song.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-mode
#| fig-cap: "Track mode and popularity."
# Major is 1, minor is 0

mode_popularity <- spotify_songs_cleaned |>
  group_by(mode) |>
  summarize(num_songs = n(),
            avg_popularity = mean(track_popularity))

mode_popularity

spotify_songs_cleaned |>
  mutate(mode = factor(mode, labels = c("minor", "major"))) |>
  ggplot(aes(x = track_popularity, group = mode, color = mode)) +
  geom_density() + labs(
    title = "Mode vs Track Popularity (Top 10% of 2019 Songs)",
    x = "Track popularity",
    y = "Density"
  ) +theme_minimal()
```

#### Valence

@fig-valence shows the relationship between valence and song popularity.

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-valence
#| fig-cap: "Track valence and popularity."
spotify_songs_cleaned |>
  ggplot(aes(x = valence, y = track_popularity)) +
  geom_point() + theme_minimal() + labs(title = "Valence vs Track Popularity (Top 10% of 2019 Songs)",
       x = "Valence", 
       y = "Count") + theme_minimal()
```
